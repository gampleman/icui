"undefined"==typeof Date.prototype.strftime&&(Date.prototype.strftime=function(){function t(t){return t.getUTCDate()+""}function e(t){return t.getUTCDay()+""}function n(t){return((t.getTime()-C.start_of_year.getTime())/R+1+"").split(/\./)[0]}function r(e){return("0"+t(e)).slice(-2)}function a(t){return t.toLocaleString()}function i(t){return t.toLocaleDateString()}function u(t){return t.toLocaleTimeString()}function o(t){var e=t.getUTCHours();return 0===e?e=12:e>12&&(e-=12),e+""}function s(t){return t.getUTCHours()}function p(t){return("0"+s(t)).slice(-2)}function c(t){return("0"+o(t)).slice(-2)}function l(t){return t.getUTCHours()>=12?"pm":"am"}function h(t){return l(t).toUpperCase()}function d(t){return("0"+t.getUTCMinutes()).slice(-2)}function f(t){return("0"+(t.getUTCMonth()+1)).slice(-2)}function y(t){return O[t.getUTCMonth()]}function _(t){return I[t.getUTCMonth()]}function m(t){return("0"+t.getUTCSeconds()).slice(-2)}function g(t){var e=t.getTimezoneOffset();return(e>=0?"-":"")+("0"+e/60).slice(-2)+":"+("0"+e%60).slice(-2)}function v(t){return("0"+Math.round(parseInt(n(t),10)/7)).slice(-2)}function D(t){return M[t.getUTCDay()]}function b(t){return k[t.getUTCDay()]}function w(t){return t.getUTCFullYear()+""}function T(t){return w(t).slice(-2)}function x(t){var e,n=t;for(C.start_of_year=new Date("Jan 1 "+this.getUTCFullYear());e=S.exec(t);)e[1]in U&&(n=n.replace(new RegExp(e[0],"mg"),U[e[1]](this)));return n}var C={start_of_year:new Date("Jan 1 "+(new Date).getFullYear())},S=/%([a-z]|%)/gim,R=864e5,M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],O=["January","February","March","April","May","June","July","August","September","October","November","December"],k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U={a:b,A:D,b:_,B:y,c:a,d:r,e:t,H:p,I:c,j:n,k:s,l:o,m:f,M:d,p:h,P:l,S:m,U:v,w:e,x:i,X:u,y:T,Y:w,z:g,"%":function(){return"%"}};return x}());var __hasProp={}.hasOwnProperty,__slice=[].slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};!function(t){var e,n,r,a,i,u,o,s,p,c,l,h,d,f,y,_,m,g,v,D;return s={clone:D=function(t){var e,n,r;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return e="",null!=t.global&&(e+="g"),null!=t.ignoreCase&&(e+="i"),null!=t.multiline&&(e+="m"),null!=t.sticky&&(e+="y"),new RegExp(t.source,e);null!=t.parent&&null!=t.data?(r=new t.constructor(t.parent,"__clone"),r.data=D(t.data)):r=new t.constructor;for(n in t)__hasProp.call(t,n)&&"parent"!==n&&"data"!==n&&"elem"!==n&&"function"!=typeof t[n]&&(r[n]=D(t[n]));return r},option:function(t,e,n){var r;return r="function"==typeof n?n(t):n===t,'<option value="'+t+'"'+(r?' selected="selected"':"")+">"+e+"</option>"},select:function(t,e){var n,r,a;r="<select>";for(a in e)n=e[a],r+=s.option(a,n,t);return r+"</select>"},daysOfTheWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsOfTheYear:["January","February","March","April","May","June","July","August","September","October","November","December"],dateFromString:function(t){var e,n,r,a,i,u,o,s,p,c,l,h,d;return l=t.split(/[\sT]/),n=l[0],s=l[1],h=function(){var t,e,r,a;for(r=n.split("-"),a=[],t=0,e=r.length;e>t;t++)o=r[t],a.push(parseInt(o,10));return a}(),c=h[0],a=h[1],e=h[2],d=function(){var t,e,n,r;for(n=s.split(":"),r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(parseInt(o,10));return r}(),r=d[0],i=d[1],u=3<=d.length?__slice.call(d,2):[],a=a-1>=0?a-1:11,p=(new Date).getTimezoneOffset(),new Date(Date.UTC(c,a,e,r,i,0,0))}},h=function(){function e(t,e){this.parent=t,null==e&&(e=null),this.destroy=__bind(this.destroy,this),this.clone=__bind(this.clone,this),this.children=[],this.data={},"__clone"!==e&&(null!=e?this.fromData(e):this.defaults())}return e.prototype.fromData=function(){},e.prototype.defaults=function(){},e.prototype.clonable=function(){return!0},e.prototype.destroyable=function(){return this.parent.children.length>1},e.prototype.clone=function(){return this.parent.children.push(s.clone(this)),this.triggerRender()},e.prototype.destroy=function(){return this.elem.slideUp(100,function(t){return function(){return t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent.triggerRender()}}(this))},e.prototype.render=function(){var e;return e=t("<div></div>"),this.clonable()&&e.append(t("<span class='btn clone'>+</span>").click(this.clone)),this.destroyable()&&e.append(t("<span class='btn destroy'>-</span>").click(this.destroy)),e.append(this.renderChildren()),e.children()},e.prototype.renderChildren=function(){var t,e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.render());return a},e.prototype.triggerRender=function(){return this.parent.triggerRender()},e}(),d=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.parent.after("<div class='icui'></div>"),this.target=this.parent.siblings(".icui").first()}return __extends(n,e),n.prototype.clonable=function(){return!1},n.prototype.destroyable=function(){return!1},n.prototype.has_ending_time=!1,n.prototype.has_rules=!1,n.prototype.fromData=function(t){var e,n,r;this.children.push(new y(this,t.start_date)),t.end_time&&(this.has_ending_time=!0,this.children.push(new o(this,t.end_time))),r=[];for(e in t)n=t[e],n.length>0&&"start_date"!==e&&"end_time"!==e&&(this.has_rules=!0,r.push(this.children.push(new _(this,{type:e,values:n}))));return r},n.prototype.defaults=function(){return this.children.push(new y(this))},n.prototype.triggerRender=function(){return this.render()},n.prototype.render=function(){var e;return this.target.html(this.renderChildren()),this.has_ending_time||(e=t("<a href='#'>Add Ending Time</a> "),e.click(function(t){return function(){return t.has_ending_time=!0,e.hide(),t.children.push(new o(t)),t.triggerRender(),!1}}(this)),this.target.append(e),this.target.append("<br />")),this.has_rules?void 0:(e=t("<a href='#'>Add Repetition</a>"),e.click(function(t){return function(){return t.has_rules=!0,e.hide(),t.children.push(new _(t)),t.triggerRender(),!1}}(this)),this.target.append(e))},n.prototype.getData=function(){var t,e,n,r,a,i;for(n={},i=this.children,r=0,a=i.length;a>r;r++)t=i[r],e=t.getData(),n[e.type]=n[e.type]?n[e.type].concat(e.values):e.values;return n},n}(h),_=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return __extends(r,e),r.prototype.defaults=function(){return this.data.type="rtimes",this.children=[new n(this)]},r.prototype.fromData=function(t){var e,r,a,i,u,o,s,p,c;if(this.data.type=t.type,this.data.type.match(/times$/)){for(o=t.values,p=[],r=0,i=o.length;i>r;r++)e=o[r],p.push(this.children.push(new n(this,e)));return p}for(s=t.values,c=[],a=0,u=s.length;u>a;a++)e=s[a],c.push(this.children.push(new f(this,e)));return c},r.prototype.getData=function(){var t,e;return this.data.type.match(/times$/)?(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData().time);return a}.call(this),{type:this.data.type,values:e}):(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData());return a}.call(this),{type:this.data.type,values:e})},r.prototype.render=function(){var e;return this.elem=t('<div class="toplevel">Event <select>\n  '+s.option(1,"occurs",function(t){return function(){return t.data.type.match(/^r/)}}(this))+"\n  "+s.option(-1,"doesn't occur",function(t){return function(){return t.data.type.match(/^ex/)}}(this))+"\n</select> on <select>\n  "+s.option("dates","specific dates",function(t){return function(){return t.data.type.match(/times$/)}}(this))+"\n  "+s.option("rules","every",function(t){return function(){return t.data.type.match(/rules$/)}}(this))+"\n</select>\n</div>"),e=this.elem.find("select"),e.first().change(function(t){return function(e){return t.data.type="1"===e.target.value?t.data.type.replace(/^ex/,"r"):t.data.type.replace(/^r/,"ex")}}(this)),e.last().change(function(t){return function(e){return"dates"===e.target.value?(t.data.type=t.data.type.match(/^r/)?"rtimes":"extimes",t.children=[new n(t)]):(t.data.type=t.data.type.match(/^r/)?"rrules":"exrules",t.children=[new f(t)]),t.triggerRender()}}(this)),this.elem.append(r.__super__.render.apply(this,arguments)),this.elem},r}(h),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.defaults=function(){var t;return null!=(t=this.data).time?t.time:t.time=new Date},n.prototype.fromData=function(t){return this.data.time=s.dateFromString(t)},n.prototype.getData=function(){return this.data},n.prototype.render=function(){var e,r,a;return this.elem=t('<div class="DatePicker">\n  <input type="date" value="'+this.data.time.strftime("%Y-%m-%d")+'" />\n  <input type="time" value="'+this.data.time.strftime("%H:%M")+'" />\n</div>'),r=this.elem.find("input"),e=r.first(),a=r.last(),r.change(function(t){return function(){return t.data.time=s.dateFromString(e.val()+" "+a.val())}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),y=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.destroyable=function(){return!1},e.prototype.clonable=function(){return!1},e.prototype.getData=function(){return{type:"start_date",values:this.data.time}},e.prototype.render=function(){return this.elem=e.__super__.render.apply(this,arguments),this.elem.prepend("Start time"),this.elem},e}(n),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.destroyable=function(){return!0},e.prototype.clonable=function(){return!1},e.prototype.getData=function(){return{type:"end_time",values:this.data.time}},e.prototype.render=function(){return this.elem=e.__super__.render.apply(this,arguments),this.elem.prepend("End time"),this.elem},e}(n),f=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.defaults=function(){return this.data.rule_type="IceCube::YearlyRule",this.children=[new g(this)],this.data.interval=1},n.prototype.fromData=function(t){var e,n,r,a;this.data.rule_type=t.rule_type,this.data.interval=t.interval,t.count&&this.children.push(new g(this,{type:"count",value:t.count})),t.until&&this.children.push(new g(this,{type:"until",value:t.until})),r=t.validations,a=[];for(e in r)n=r[e],a.push(this.children.push(new g(this,{type:e,value:n})));return a},n.prototype.getData=function(){var t,e,n,r,a,i,u,o,s,p,c,l,h;for(a={},p=this.children,i=0,o=p.length;o>i;i++)if(t=p[i],"count"!==t.data.type&&"until"!==t.data.type){c=t.getData();for(n in c)r=c[n],a[n]=r}for(e={rule_type:this.data.rule_type,interval:this.data.interval,validations:a},l=this.children,u=0,s=l.length;s>u;u++)if(t=l[u],"count"===t.data.type||"until"===t.data.type){h=t.getData();for(n in h)r=h[n],e[n]=r}return e},n.prototype.render=function(){return this.elem=t('<div class="Rule">\n  Every\n  <input type="number" value="'+this.data.interval+'" size="2" width="30" />\n  '+s.select(this.data.rule_type,{"IceCube::YearlyRule":"years","IceCube::MonthlyRule":"months","IceCube::WeeklyRule":"weeks","IceCube::DailyRule":"days"})+"\n</div>"),this.elem.find("input").change(function(t){return function(e){return t.data.interval=parseInt(e.target.value)}}(this)),this.elem.find("select").change(function(t){return function(e){return t.data.rule_type=e.target.value,t.children=[new g(t)],t.triggerRender()}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),g=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,n),o.prototype.defaults=function(){return this.data.type="count",this.children=[new e(this)]},o.prototype.fromData=function(t){var n,a,u,o,s,p,c,l,h,d,f,y,_,g,v;switch(this.data.type=t.type,t.type){case"count":return this.children.push(new e(this,t.value));case"until":return this.children.push(new m(this,t.value));case"day":for(d=t.value,_=[],p=0,l=d.length;l>p;p++)o=d[p],_.push(this.children.push(new r(this,o)));return _;case"day_of_week":f=t.value,g=[];for(a in f)s=f[a],g.push(function(){var t,e,n;for(n=[],t=0,e=s.length;e>t;t++)o=s[t],n.push(this.children.push(new i(this,{nth:o,day:a})));return n}.call(this));return g;default:for(y=t.value,v=[],c=0,h=y.length;h>c;c++)o=y[c],u=this.choices(t.type),n=new u(this,o),v.push(this.children.push(n));return v}},o.prototype.choices=function(t){return{count:e,until:m,day:r,day_of_week:i,day_of_month:a,day_of_year:u,month_of_year:c,offset_from_pascha:l}[t]},o.prototype.getData=function(){var t,e,n,r,a,i;return n=this.data.type,i=function(){var i,u,o,s,p,c,l,h;switch(n){case"count":return this.children[0].getData();case"until":return this.children[0].getData();case"day_of_week":for(r={},p=this.children,i=0,o=p.length;o>i;i++)t=p[i],c=t.getData(),e=c[0],a=c[1],null==r[e]&&(r[e]=[]),r[e].push(a);return r;default:for(l=this.children,h=[],u=0,s=l.length;s>u;u++)t=l[u],h.push(t.getData());return h}}.call(this),r={},r[n]=i,r},o.prototype.destroyable=function(){return!0},o.prototype.render=function(){var e,n;return e='<div class="Validation">\n  '+(this.parent.children.indexOf(this)>0?"and if":"If")+" <select>\n    "+s.option("count","event occured less than",this.data.type)+"\n    "+s.option("until","event is before",this.data.type)+"\n    "+s.option("day","is this day of the week",this.data.type),("IceCube::YearlyRule"===(n=this.parent.data.rule_type)||"IceCube::MonthlyRule"===n)&&(e+=s.option("day_of_week","is this day of the nth week",this.data.type),e+=s.option("day_of_month","is the nth day of the month",this.data.type)),"IceCube::YearlyRule"===this.parent.data.rule_type&&(e+=s.option("day_of_year","is the nth day of the year",this.data.type),e+=s.option("month_of_year","falls within month",this.data.type),e+=s.option("offset_from_pascha","is offset from Pascha",this.data.type)),e+="  </select>\n</div>",this.elem=t(e),this.elem.find("select").change(function(t){return function(e){var n;return n=t.choices(e.target.value),t.children=[new n(t)],t.data.type=e.target.value,t.triggerRender()}}(this)),this.elem.append(o.__super__.render.apply(this,arguments)),this.elem},o}(h),v=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.defaults=function(){return this.data.value=this["default"]},n.prototype.fromData=function(t){return this.data.value=t},n.prototype.getData=function(){return this.data.value},n.prototype.dataTransformer=parseInt,n.prototype["default"]=1,n.prototype.render=function(){return this.elem=t(this.html()),this.elem.find("input,select").change(function(t){return function(e){return t.data.value=t.dataTransformer(e.target.value)}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.clonable=function(){return!1},e.prototype.html=function(){return'<div class="Count">\n  <input type="number" value='+this.data.value+" /> times.\n</div>"},e}(v),m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.getData=function(){return this.data.time},e.prototype.clonable=function(){return!1},e.prototype.destroyable=function(){return!1},e}(n),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.html=function(){var t,e,n,r;for(e=function(t){switch(t>10&&20>t?4:t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},n='<div class="DayOfMonth">\n  <select>',t=r=1;31>=r;t=++r)n+=s.option(t.toString(),""+t+e(t),this.data.value.toString());return n+=s.option("-1","last",this.data.value.toString()),n+="</select> day of the month.\n</div>"},e}(v),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.html=function(){var t,e,n,r,a,i;for(n='<div class="Day">\n  <select>',i=s.daysOfTheWeek,e=r=0,a=i.length;a>r;e=++r)t=i[e],n+=s.option(e.toString(),t,this.data.value.toString());return n+="</select>\n</div>"},e}(v),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.getData=function(){return[this.data.day,this.data.nth]},n.prototype.fromData=function(t){this.data=t},n.prototype.defaults=function(){return this.data.nth=1,this.data.day=0},n.prototype.render=function(){var e,r,a,i,u,o,p;for(i='<div class="DayOfWeek">\n  <input type="number" value='+this.data.nth+" /><span>nth</span>.\n  <select>",p=s.daysOfTheWeek,r=u=0,o=p.length;o>u;r=++u)e=p[r],i+=s.option(r.toString(),e,this.data.day.toString());return i+="</select></div>",this.elem=t(i),a=function(t){return function(){return t.elem.find("span").first().text(function(){switch(this.data.nth){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}.call(t))}}(this),this.elem.find("input").change(function(t){return function(e){return t.data.nth=parseInt(e.target.value),a()}}(this)),this.elem.find("select").change(function(t){return function(e){return t.data.day=parseInt(e.target.value)}}(this)),a(),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.getData=function(){return this.data.value},n.prototype.fromData=function(t){return this.data.value=t},n.prototype.defaults=function(){return this.data.value=1},n.prototype.render=function(){var e;return e='<div class="DayOfYear">\n  <input type="number" value='+Math.abs(this.data.value)+" /> day from the\n  <select>\n    "+s.option("+","beggening",function(t){return function(){return t.data.value>=0}}(this))+"\n    "+s.option("-","end",function(t){return function(){return t.data.value<0}}(this))+"\n  </select> of the year.</div>",this.elem=t(e),this.elem.find("input,select").change(function(t){return function(){return t.data.value=parseInt(t.elem.find("input").val()),t.data.value*="+"===t.elem.find("select").val()?1:-1}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),c=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.getData=function(){return this.data.value},n.prototype.fromData=function(t){return this.data.value=t},n.prototype.defaults=function(){return this.data.value=1},n.prototype.render=function(){var e,r,a,i,u,o;for(a='<div class="DayOfYear">\n  <select>',o=s.monthsOfTheYear,e=i=0,u=o.length;u>i;e=++i)r=o[e],a+=s.option((e+1).toString(),r,this.data.value.toString());return a+="</select></div>",this.elem=t(a),this.elem.find("input,select").change(function(t){return function(){return t.data.value=t.elem.find("select").val()}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.getData=function(){return this.data.value},n.prototype.defaults=function(){return this.data.value=0},n.prototype.fromData=function(t){return this.data.value=t},n.prototype.render=function(){var e;return e='<div class="OffsetFromPascha">\n  <input type="number" value='+Math.abs(this.data.value)+" /> days\n  <select>\n    "+s.option("+","after",function(t){return function(){return t.data.value>=0}}(this))+"\n    "+s.option("-","before",function(t){return function(){return t.data.value<0}}(this))+"\n  </select> Pascha.</div>",this.elem=t(e),this.elem.find("input,select").change(function(t){return function(){return t.data.value=parseInt(t.elem.find("input").val()),t.data.value*="+"===t.elem.find("select").val()?1:-1}}(this)),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(h),p=function(){function t(t,e){var n,r;n=function(){try{return JSON.parse(t.val())}catch(e){return r=e,null}}(),this.root=new d(t,n),t.parents("form").on("submit",function(n){return function(r){return e.submit?(e.submit(n.getData()),r.preventDefault(),!1):t.val(JSON.stringify(n.getData()))}}(this)),t.after(this.root.render())}return t.prototype.getData=function(){return this.root.getData()},t}(),t.fn.icui=function(e){return null==e&&(e={}),this.each(function(){return new p(t(this),e)})}}(jQuery);