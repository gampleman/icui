Date.prototype.strftime===void 0&&(Date.prototype.strftime=function(){function t(t){return t.getUTCDate()+""}function e(t){return t.getUTCDay()+""}function n(t){return((t.getTime()-x.start_of_year.getTime())/I+1+"").split(/\./)[0]}function r(e){return("0"+t(e)).slice(-2)}function a(t){return t.toLocaleString()}function i(t){return t.toLocaleDateString()}function u(t){return t.toLocaleTimeString()}function s(t){var e=t.getUTCHours();return e===0?e=12:e>12&&(e-=12),e+""}function o(t){return t.getUTCHours()}function p(t){return("0"+o(t)).slice(-2)}function l(t){return("0"+s(t)).slice(-2)}function c(t){return t.getUTCHours()>=12?"pm":"am"}function h(t){return c(t).toUpperCase()}function d(t){return("0"+t.getUTCMinutes()).slice(-2)}function f(t){return("0"+(t.getUTCMonth()+1)).slice(-2)}function y(t){return S[t.getUTCMonth()]}function _(t){return U[t.getUTCMonth()]}function m(t){return("0"+t.getUTCSeconds()).slice(-2)}function g(t){var e=t.getTimezoneOffset();return(e>=0?"-":"")+("0"+e/60).slice(-2)+":"+("0"+e%60).slice(-2)}function v(t){return("0"+Math.round(parseInt(n(t),10)/7)).slice(-2)}function D(t){return M[t.getUTCDay()]}function b(t){return k[t.getUTCDay()]}function w(t){return t.getUTCFullYear()+""}function T(t){return w(t).slice(-2)}function C(t){var e,n=t;x.start_of_year=new Date("Jan 1 "+this.getUTCFullYear());while(e=R.exec(t))e[1]in O&&(n=n.replace(RegExp(e[0],"mg"),O[e[1]](this)));return n}var x={start_of_year:new Date("Jan 1 "+(new Date).getFullYear())},R=/%([a-z]|%)/gim,I=864e5,M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],S=["January","February","March","April","May","June","July","August","September","October","November","December"],k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],O={a:b,A:D,b:_,B:y,c:a,d:r,e:t,H:p,I:l,j:n,k:o,l:s,m:f,M:d,p:h,P:c,S:m,U:v,w:e,x:i,X:u,y:T,Y:w,z:g,"%":function(){return"%"}};return C}());var __hasProp=Object.prototype.hasOwnProperty,__slice=Array.prototype.slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(t){var e,n,r,a,i,u,s,o,p,l,c,h,d,f,y,_,m,g;return t==null&&(t=jQuery),s={clone:g=function(t){var e,n,r;if(t==null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return e="",t.global!=null&&(e+="g"),t.ignoreCase!=null&&(e+="i"),t.multiline!=null&&(e+="m"),t.sticky!=null&&(e+="y"),RegExp(t.source,e);t.parent!=null&&t.data!=null?(r=new t.constructor(t.parent,"__clone"),r.data=g(t.data)):r=new t.constructor;for(n in t)__hasProp.call(t,n)&&n!=="parent"&&n!=="data"&&n!=="elem"&&typeof t[n]!="function"&&(r[n]=g(t[n]));return r},option:function(t,e,n){var r;return r=typeof n=="function"?n(t):n===t,'<option value="'+t+'"'+(r?' selected="selected"':"")+">"+e+"</option>"},select:function(t,e){var n,r,a;r="<select>";for(a in e)n=e[a],r+=s.option(a,n,t);return r+"</select>"},daysOfTheWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateFromString:function(t){var e,n,r,a,i,u,s,o,p,l,c,h,d;return c=t.split(/[\sT]/),n=c[0],o=c[1],h=function(){var t,e,r,a;for(r=n.split("-"),a=[],t=0,e=r.length;e>t;t++)s=r[t],a.push(parseInt(s,10));return a}(),l=h[0],a=h[1],e=h[2],d=function(){var t,e,n,r;for(n=o.split(":"),r=[],t=0,e=n.length;e>t;t++)s=n[t],r.push(parseInt(s,10));return r}(),r=d[0],i=d[1],u=d.length>=3?__slice.call(d,2):[],a=a-1>=0?a-1:11,p=(new Date).getTimezoneOffset(),new Date(Date.UTC(l,a,e,r,i,0,0))}},l=function(){function e(t,e){this.parent=t,e==null&&(e=null),this.destroy=__bind(this.destroy,this),this.clone=__bind(this.clone,this),this.children=[],this.data={},e!=="__clone"&&(e!=null?this.fromData(e):this.defaults())}return e.prototype.fromData=function(){},e.prototype.defaults=function(){},e.prototype.clonable=function(){return!0},e.prototype.destroyable=function(){return this.parent.children.length>1},e.prototype.clone=function(){return this.parent.children.push(s.clone(this)),this.triggerRender()},e.prototype.destroy=function(){var t=this;return this.elem.slideUp(100,function(){return t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent.triggerRender()})},e.prototype.render=function(){var e;return e=t("<div></div>"),this.clonable()&&e.append(t("<span class='btn clone'>+</span>").click(this.clone)),this.destroyable()&&e.append(t("<span class='btn destroy'>-</span>").click(this.destroy)),e.append(this.renderChildren()),e.children()},e.prototype.renderChildren=function(){var t,e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.render());return a},e.prototype.triggerRender=function(){return this.parent.triggerRender()},e}(),c=function(){function e(){e.__super__.constructor.apply(this,arguments),this.parent.after("<div class='icui'></div>"),this.target=this.parent.siblings(".icui").first()}return __extends(e,l),e.prototype.clonable=function(){return!1},e.prototype.destroyable=function(){return!1},e.prototype.fromData=function(t){var e,n,r;this.children.push(new d(this,t.start_date)),r=[];for(e in t)n=t[e],n.length>0&&e!=="start_date"&&r.push(this.children.push(new f(this,{type:e,values:n})));return r},e.prototype.defaults=function(){return this.children.push(new d(this))},e.prototype.triggerRender=function(){return this.render()},e.prototype.render=function(){var e,n=this;return this.target.html(this.renderChildren()),this.children.length===1?(e=t("<a href='#'>Add repetition</a>"),e.click(function(){return e.hide(),n.children.push(new f(n)),n.triggerRender(),!1}),this.target.append(e)):void 0},e.prototype.getData=function(){var t,e,n,r,a,i;for(n={},i=this.children,r=0,a=i.length;a>r;r++)t=i[r],e=t.getData(),n[e.type]=n[e.type]?n[e.type].concat(e.values):e.values;return n},e}(),f=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.defaults=function(){return this.data.type="rtimes",this.children=[new n(this)]},e.prototype.fromData=function(t){var e,r,a,i,u,s,o,p,l;if(this.data.type=t.type,this.data.type.match(/times$/)){for(s=t.values,p=[],r=0,i=s.length;i>r;r++)e=s[r],p.push(this.children.push(new n(this,e)));return p}for(o=t.values,l=[],a=0,u=o.length;u>a;a++)e=o[a],l.push(this.children.push(new h(this,e)));return l},e.prototype.getData=function(){var t,e;return this.data.type.match(/times$/)?(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData().time);return a}.call(this),{type:this.data.type,values:e}):(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData());return a}.call(this),{type:this.data.type,values:e})},e.prototype.render=function(){var r,a=this;return this.elem=t('<div class="toplevel">Event <select>\n  '+s.option(1,"occurs",function(){return a.data.type.match(/^r/)})+"\n  "+s.option(-1,"doesn't occur",function(){return a.data.type.match(/^ex/)})+"\n</select> on <select>\n  "+s.option("dates","specific dates",function(){return a.data.type.match(/times$/)})+"\n  "+s.option("rules","every",function(){return a.data.type.match(/rules$/)})+"\n</select>\n</div>"),r=this.elem.find("select"),r.first().change(function(t){return a.data.type=t.target.value==="1"?a.data.type.replace(/^ex/,"r"):a.data.type.replace(/^r/,"ex")}),r.last().change(function(t){return t.target.value==="dates"?(a.data.type=a.data.type.match(/^r/)?"rtimes":"extimes",a.children=[new n(a)]):(a.data.type=a.data.type.match(/^r/)?"rrules":"exrules",a.children=[new h(a)]),a.triggerRender()}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),n=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.defaults=function(){var t,e;return(e=(t=this.data).time)!=null?e:t.time=new Date},e.prototype.fromData=function(t){return this.data.time=s.dateFromString(t)},e.prototype.getData=function(){return this.data},e.prototype.render=function(){var n,r,a,i=this;return this.elem=t('<div class="DatePicker">\n  <input type="date" value="'+this.data.time.strftime("%Y-%m-%d")+'" />\n  <input type="time" value="'+this.data.time.strftime("%H:%M")+'" />\n</div>'),r=this.elem.find("input"),n=r.first(),a=r.last(),r.change(function(){return i.data.time=s.dateFromString(n.val()+" "+a.val())}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),d=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t.prototype.destroyable=function(){return!1},t.prototype.clonable=function(){return!1},t.prototype.getData=function(){return{type:"start_date",values:this.data.time}},t.prototype.render=function(){return this.elem=t.__super__.render.apply(this,arguments),this.elem.prepend("Start time"),this.elem},t}(),h=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.defaults=function(){return this.data.rule_type="IceCube::YearlyRule",this.children=[new _(this)],this.data.interval=1},e.prototype.fromData=function(t){var e,n,r,a;this.data.rule_type=t.rule_type,this.data.interval=t.interval,t.count&&this.children.push(new _(this,{type:"count",value:t.count})),t.until&&this.children.push(new _(this,{type:"until",value:t.until})),r=t.validations,a=[];for(e in r)n=r[e],a.push(this.children.push(new _(this,{type:e,value:n})));return a},e.prototype.getData=function(){var t,e,n,r,a,i,u,s,o,p,l,c,h;for(a={},p=this.children,i=0,s=p.length;s>i;i++)if(t=p[i],t.data.type!=="count"&&t.data.type!=="until"){l=t.getData();for(n in l)r=l[n],a[n]=r}for(e={rule_type:this.data.rule_type,interval:this.data.interval,validations:a},c=this.children,u=0,o=c.length;o>u;u++)if(t=c[u],t.data.type==="count"||t.data.type==="until"){h=t.getData();for(n in h)r=h[n],e[n]=r}return e},e.prototype.render=function(){var n=this;return this.elem=t('<div class="Rule">\n  Every \n  <input type="number" value="'+this.data.interval+'" size="2" width="30" />\n  '+s.select(this.data.rule_type,{"IceCube::YearlyRule":"years","IceCube::MonthlyRule":"months","IceCube::WeeklyRule":"weeks","IceCube::DailyRule":"days"})+"\n</div>"),this.elem.find("input").change(function(t){return n.data.interval=parseInt(t.target.value)}),this.elem.find("select").change(function(t){return n.data.rule_type=t.target.value,n.children=[new _(n)],n.triggerRender()}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),_=function(){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,l),n.prototype.defaults=function(){return this.data.type="count",this.children=[new e(this)]},n.prototype.fromData=function(t){var n,a,u,s,o,p,l,c,h,d,f,_,m,g,v;switch(this.data.type=t.type,t.type){case"count":return this.children.push(new e(this,t.value));case"until":return this.children.push(new y(this,t.value));case"day":for(d=t.value,m=[],p=0,c=d.length;c>p;p++)s=d[p],m.push(this.children.push(new r(this,s)));return m;case"day_of_week":f=t.value,g=[];for(a in f)o=f[a],g.push(function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)s=o[t],n.push(this.children.push(new i(this,{nth:s,day:a})));return n}.call(this));return g;default:for(_=t.value,v=[],l=0,h=_.length;h>l;l++)s=_[l],u=this.choices(t.type),n=new u(this,s),v.push(this.children.push(n));return v}},n.prototype.choices=function(t){return{count:e,until:y,day:r,day_of_week:i,day_of_month:a,day_of_year:u,offset_from_pascha:p}[t]},n.prototype.getData=function(){var t,e,n,r,a,i;return n=this.data.type,i=function(){var i,u,s,o,p,l,c,h,d;switch(n){case"count":return this.children[0].getData();case"until":return this.children[0].getData();case"day_of_week":for(r={},p=this.children,i=0,s=p.length;s>i;i++)t=p[i],l=t.getData(),e=l[0],a=l[1],(c=r[e])==null&&(r[e]=[]),r[e].push(a);return r;default:for(h=this.children,d=[],u=0,o=h.length;o>u;u++)t=h[u],d.push(t.getData());return d}}.call(this),r={},r[n]=i,r},n.prototype.destroyable=function(){return!0},n.prototype.render=function(){var e,r,a=this;return e='<div class="Validation">\n  '+(this.parent.children.indexOf(this)>0?"and if":"If")+" <select>\n    "+s.option("count","event occured less than",this.data.type)+"\n    "+s.option("until","event is before",this.data.type)+"\n    "+s.option("day","is this day of the week",this.data.type),((r=this.parent.data.rule_type)==="IceCube::YearlyRule"||r==="IceCube::MonthlyRule")&&(e+=s.option("day_of_week","is this day of the nth week",this.data.type),e+=s.option("day_of_month","is the nth day of the month",this.data.type)),this.parent.data.rule_type==="IceCube::YearlyRule"&&(e+=s.option("day_of_year","is the nth day of the year",this.data.type),e+=s.option("offset_from_pascha","is offset from Pascha",this.data.type)),e+="  </select>\n</div>",this.elem=t(e),this.elem.find("select").change(function(t){var e;return e=a.choices(t.target.value),a.children=[new e(a)],a.data.type=t.target.value,a.triggerRender()}),this.elem.append(n.__super__.render.apply(this,arguments)),this.elem},n}(),m=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.defaults=function(){return this.data.value=this["default"]},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.getData=function(){return this.data.value},e.prototype.dataTransformer=parseInt,e.prototype["default"]=1,e.prototype.render=function(){var n=this;return this.elem=t(this.html()),this.elem.find("input,select").change(function(t){return n.data.value=n.dataTransformer(t.target.value)}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),e=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,m),t.prototype.clonable=function(){return!1},t.prototype.html=function(){return'<div class="Count">\n  <input type="number" value='+this.data.value+" /> times.\n</div>"},t}(),y=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t.prototype.getData=function(){return this.data.time},t.prototype.clonable=function(){return!1},t.prototype.destroyable=function(){return!1},t}(),a=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,m),t.prototype.html=function(){var t,e,n;for(e=function(t){switch(t>10&&20>t?4:t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},n='<div class="DayOfMonth">\n  <select>',t=1;31>=t;t++)n+=s.option(t+"",""+t+e(t),this.data.value+"");return n+=s.option("-1","last",this.data.value+""),n+="</select> day of the month.\n</div>"},t}(),r=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,m),t.prototype.html=function(){var t,e,n,r,a;for(n='<div class="Day">\n  <select>',a=s.daysOfTheWeek,e=0,r=a.length;r>e;e++)t=a[e],n+=s.option(e+"",t,this.data.value+"");return n+="</select>\n</div>"},t}(),i=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.getData=function(){return[this.data.day,this.data.nth]},e.prototype.fromData=function(t){this.data=t},e.prototype.defaults=function(){return this.data.nth=1,this.data.day=0},e.prototype.render=function(){var n,r,a,i,u,o,p=this;for(i='<div class="DayOfWeek">\n  <input type="number" value='+this.data.nth+" /><span>nth</span>.\n  <select>",o=s.daysOfTheWeek,r=0,u=o.length;u>r;r++)n=o[r],i+=s.option(r+"",n,this.data.day+"");return i+="</select></div>",this.elem=t(i),a=function(){return p.elem.find("span").first().text(function(){switch(this.data.nth){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}.call(p))},this.elem.find("input").change(function(t){return p.data.nth=parseInt(t.target.value),a()}),this.elem.find("select").change(function(t){return p.data.day=parseInt(t.target.value)}),a(),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),u=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.getData=function(){return this.data.value},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.defaults=function(){return this.data.value=1},e.prototype.render=function(){var n,r=this;return n='<div class="DayOfYear">\n  <input type="number" value='+Math.abs(this.data.value)+" /> day from the \n  <select>\n    "+s.option("+","beggening",function(){return r.data.value>=0})+"\n    "+s.option("-","end",function(){return 0>r.data.value})+"\n  </select> of the year.</div>",this.elem=t(n),this.elem.find("input,select").change(function(){return r.data.value=parseInt(r.elem.find("input").val()),r.data.value*=r.elem.find("select").val()==="+"?1:-1}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),p=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,l),e.prototype.getData=function(){return this.data.value},e.prototype.defaults=function(){return this.data.value=0},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.render=function(){var n,r=this;return n='<div class="OffsetFromPascha">\n  <input type="number" value='+Math.abs(this.data.value)+" /> days \n  <select>\n    "+s.option("+","after",function(){return r.data.value>=0})+"\n    "+s.option("-","before",function(){return 0>r.data.value})+"\n  </select> Pascha.</div>",this.elem=t(n),this.elem.find("input,select").change(function(){return r.data.value=parseInt(r.elem.find("input").val()),r.data.value*=r.elem.find("select").val()==="+"?1:-1}),this.elem.append(e.__super__.render.apply(this,arguments)),this.elem},e}(),o=function(){function t(t,e){var n,r=this;n=function(){try{return JSON.parse(t.val())}catch(e){return null}}(),this.root=new c(t,n),t.parents("form").on("submit",function(n){return e.submit?(e.submit(r.getData()),n.preventDefault(),!1):t.val(JSON.stringify(r.getData()))}),t.after(this.root.render())}return t.prototype.getData=function(){return this.root.getData()},t}(),t.fn.icui=function(e){return e==null&&(e={}),this.each(function(){return new o(t(this),e)})}})($)