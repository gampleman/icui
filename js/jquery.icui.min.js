Date.prototype.strftime===void 0&&(Date.prototype.strftime=function(){function t(t){return t.getUTCDate()+""}function e(t){return t.getUTCDay()+""}function n(t){return((t.getTime()-x.start_of_year.getTime())/I+1+"").split(/\./)[0]}function r(e){return("0"+t(e)).slice(-2)}function a(t){return t.toLocaleString()}function i(t){return t.toLocaleDateString()}function u(t){return t.toLocaleTimeString()}function o(t){var e=t.getUTCHours();return e===0?e=12:e>12&&(e-=12),e+""}function s(t){return t.getUTCHours()}function p(t){return("0"+s(t)).slice(-2)}function c(t){return("0"+o(t)).slice(-2)}function l(t){return t.getUTCHours()>=12?"pm":"am"}function h(t){return l(t).toUpperCase()}function d(t){return("0"+t.getUTCMinutes()).slice(-2)}function f(t){return("0"+(t.getUTCMonth()+1)).slice(-2)}function y(t){return S[t.getUTCMonth()]}function _(t){return O[t.getUTCMonth()]}function g(t){return("0"+t.getUTCSeconds()).slice(-2)}function v(t){var e=t.getTimezoneOffset();return(e>=0?"-":"")+("0"+e/60).slice(-2)+":"+("0"+e%60).slice(-2)}function m(t){return("0"+Math.round(parseInt(n(t),10)/7)).slice(-2)}function D(t){return M[t.getUTCDay()]}function b(t){return k[t.getUTCDay()]}function w(t){return t.getUTCFullYear()+""}function T(t){return w(t).slice(-2)}function C(t){var e,n=t;x.start_of_year=new Date("Jan 1 "+this.getUTCFullYear());while(e=R.exec(t))e[1]in U&&(n=n.replace(RegExp(e[0],"mg"),U[e[1]](this)));return n}var x={start_of_year:new Date("Jan 1 "+(new Date).getFullYear())},R=/%([a-z]|%)/gim,I=864e5,M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],S=["January","February","March","April","May","June","July","August","September","October","November","December"],k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U={a:b,A:D,b:_,B:y,c:a,d:r,e:t,H:p,I:c,j:n,k:s,l:o,m:f,M:d,p:h,P:l,S:g,U:m,w:e,x:i,X:u,y:T,Y:w,z:v,"%":function(){return"%"}};return C}());var __hasProp=Object.prototype.hasOwnProperty,__slice=Array.prototype.slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(t){var e,n,r,a,i,u,o,s,p,c,l,h,d,f,y,_,g,v;return t==null&&(t=jQuery),o={clone:v=function(t){var e,n,r;if(t==null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return e="",t.global!=null&&(e+="g"),t.ignoreCase!=null&&(e+="i"),t.multiline!=null&&(e+="m"),t.sticky!=null&&(e+="y"),RegExp(t.source,e);t.parent!=null&&t.data!=null?(r=new t.constructor(t.parent,"__clone"),r.data=v(t.data)):r=new t.constructor;for(n in t)__hasProp.call(t,n)&&n!=="parent"&&n!=="data"&&typeof t[n]!="function"&&(r[n]=v(t[n]));return r},option:function(t,e,n){var r;return r=typeof n=="function"?n(t):n===t,'<option value="'+t+'"'+(r?' selected="selected"':"")+">"+e+"</option>"},select:function(t,e){var n,r,a;r="<select>";for(a in e)n=e[a],r+=o.option(a,n,t);return r+"</select>"},daysOfTheWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateFromString:function(t){var e,n,r,a,i,u,o,s,p,c,l,h,d;return l=t.split(/[\sT]/),n=l[0],s=l[1],h=function(){var t,e,r,a;for(r=n.split("-"),a=[],t=0,e=r.length;e>t;t++)o=r[t],a.push(parseInt(o,10));return a}(),c=h[0],a=h[1],e=h[2],d=function(){var t,e,n,r;for(n=s.split(":"),r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(parseInt(o,10));return r}(),r=d[0],i=d[1],u=d.length>=3?__slice.call(d,2):[],a=a-1>=0?a-1:11,p=(new Date).getTimezoneOffset(),new Date(Date.UTC(c,a,e,r,i,0,0))}},c=function(){function e(t,e){this.parent=t,e==null&&(e=null),this.destroy=__bind(this.destroy,this),this.clone=__bind(this.clone,this),this.children=[],this.data={},e!=="__clone"&&(e!=null?this.fromData(e):this.defaults())}return e.prototype.fromData=function(){},e.prototype.defaults=function(){},e.prototype.clonable=function(){return!0},e.prototype.destroyable=function(){return this.parent.children.length>1},e.prototype.clone=function(){return this.parent.children.push(o.clone(this)),this.triggerRender()},e.prototype.destroy=function(){return this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.triggerRender()},e.prototype.render=function(){var e;return e=t("<div></div>"),this.clonable()&&e.append(t("<span class='btn clone'>+</span>").click(this.clone)),this.destroyable()&&e.append(t("<span class='btn destroy'>-</span>").click(this.destroy)),e.append(this.renderChildren()),e.children()},e.prototype.renderChildren=function(){var t,e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.render());return a},e.prototype.triggerRender=function(){return this.parent.triggerRender()},e}(),l=function(){function e(){e.__super__.constructor.apply(this,arguments),this.parent.after("<div class='icui'></div>"),this.target=this.parent.siblings(".icui").first()}return __extends(e,c),e.prototype.clonable=function(){return!1},e.prototype.destroyable=function(){return!1},e.prototype.fromData=function(t){var e,n,r;this.children.push(new d(this,t.start_date)),r=[];for(e in t)n=t[e],n.length>0&&e!=="start_date"&&r.push(this.children.push(new f(this,{type:e,values:n})));return r},e.prototype.defaults=function(){return this.children.push(new d(this))},e.prototype.triggerRender=function(){return this.render()},e.prototype.render=function(){var e,n=this;return this.target.html(this.renderChildren()),this.children.length===1?(e=t("<a href='#'>Add repetition</a>"),e.click(function(){return e.hide(),n.children.push(new f(n)),n.triggerRender()}),this.target.append(e)):void 0},e.prototype.getData=function(){var t,e,n,r,a,i;for(n={},i=this.children,r=0,a=i.length;a>r;r++)t=i[r],e=t.getData(),n[e.type]=n[e.type]?n[e.type].concat(e.values):e.values;return n},e}(),f=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){return this.data.type="rtimes",this.children=[new n(this)]},e.prototype.fromData=function(t){var e,r,a,i,u,o,s,p,c;if(this.data.type=t.type,this.data.type.match(/times$/)){for(o=t.values,p=[],r=0,i=o.length;i>r;r++)e=o[r],p.push(this.children.push(new n(this,e)));return p}for(s=t.values,c=[],a=0,u=s.length;u>a;a++)e=s[a],c.push(this.children.push(new h(this,e)));return c},e.prototype.getData=function(){var t,e;return this.data.type.match(/times$/)?(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData().time);return a}.call(this),{type:this.data.type,values:e}):(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData());return a}.call(this),{type:this.data.type,values:e})},e.prototype.render=function(){var r,a,i=this;return r=t('<div class="toplevel">Event <select>\n  '+o.option(1,"occurs",function(){return i.data.type.match(/^r/)})+"\n  "+o.option(-1,"doesn't occur",function(){return i.data.type.match(/^ex/)})+"\n</select> on <select>\n  "+o.option("dates","specific dates",function(){return i.data.type.match(/times$/)})+"\n  "+o.option("rules","every",function(){return i.data.type.match(/rules$/)})+"\n</select>\n</div>"),a=r.find("select"),a.first().change(function(t){return i.data.type=t.target.value==="1"?i.data.type.replace(/^ex/,"r"):i.data.type.replace(/^r/,"ex")}),a.last().change(function(t){return t.target.value==="dates"?(i.data.type=i.data.type.match(/^r/)?"rtimes":"extimes",i.children=[new n(i)]):(i.data.type=i.data.type.match(/^r/)?"rrules":"exrules",i.children=[new h(i)]),i.triggerRender()}),r.append(e.__super__.render.apply(this,arguments)),r},e}(),n=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){var t,e;return(e=(t=this.data).time)!=null?e:t.time=new Date},e.prototype.fromData=function(t){return this.data.time=o.dateFromString(t)},e.prototype.getData=function(){return this.data},e.prototype.render=function(){var n,r,a,i,u=this;return n=t('<div class="DatePicker">\n  <input type="date" value="'+this.data.time.strftime("%Y-%m-%d")+'" />\n  <input type="time" value="'+this.data.time.strftime("%H:%M")+'" />\n</div>'),a=n.find("input"),r=a.first(),i=a.last(),a.change(function(){return u.data.time=o.dateFromString(r.val()+" "+i.val())}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),d=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t.prototype.destroyable=function(){return!1},t.prototype.clonable=function(){return!1},t.prototype.getData=function(){return{type:"start_date",values:this.data.time}},t.prototype.render=function(){var e;return e=t.__super__.render.apply(this,arguments),e.prepend("Start time"),e},t}(),h=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){return this.data.rule_type="IceCube::YearlyRule",this.children=[new _(this)],this.data.interval=1},e.prototype.fromData=function(t){var e,n,r,a;this.data.rule_type=t.rule_type,this.data.interval=t.interval,t.count&&this.children.push(new _(this,{type:"count",value:t.count})),t.until&&this.children.push(new _(this,{type:"until",value:t.until})),r=t.validations,a=[];for(e in r)n=r[e],a.push(this.children.push(new _(this,{type:e,value:n})));return a},e.prototype.getData=function(){var t,e,n,r,a,i,u,o,s,p,c,l,h;for(a={},p=this.children,i=0,o=p.length;o>i;i++)if(t=p[i],t.data.type!=="count"&&t.data.type!=="until"){c=t.getData();for(n in c)r=c[n],a[n]=r}for(e={rule_type:this.data.rule_type,interval:this.data.interval,validations:a},l=this.children,u=0,s=l.length;s>u;u++)if(t=l[u],t.data.type==="count"||t.data.type==="until"){h=t.getData();for(n in h)r=h[n],e[n]=r}return e},e.prototype.render=function(){var n,r=this;return n=t('<div class="Rule">\n  Every \n  <input type="number" value="'+this.data.interval+'" size="2" width="30" />\n  '+o.select(this.data.rule_type,{"IceCube::YearlyRule":"years","IceCube::MonthlyRule":"months","IceCube::WeeklyRule":"weeks","IceCube::DailyRule":"days"})+"\n</div>"),n.find("input").change(function(t){return r.data.interval=parseInt(t.target.value)}),n.find("select").change(function(t){return r.data.rule_type=t.target.value,r.children=[new _(r)],r.triggerRender()}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),_=function(){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,c),n.prototype.defaults=function(){return this.data.type="count",this.children=[new e(this)]},n.prototype.fromData=function(t){var n,a,u,o,s,p,c,l,h,d,f,_,g,v,m;switch(this.data.type=t.type,t.type){case"count":return this.children.push(new e(this,t.value));case"until":return this.children.push(new y(this,t.value));case"day":for(d=t.value,g=[],p=0,l=d.length;l>p;p++)o=d[p],g.push(this.children.push(new r(this,o)));return g;case"day_of_week":f=t.value,v=[];for(a in f)s=f[a],v.push(function(){var t,e,n;for(n=[],t=0,e=s.length;e>t;t++)o=s[t],n.push(this.children.push(new i(this,{nth:o,day:a})));return n}.call(this));return v;default:for(_=t.value,m=[],c=0,h=_.length;h>c;c++)o=_[c],u=this.choices(t.type),n=new u(this,o),m.push(this.children.push(n));return m}},n.prototype.choices=function(t){return{count:e,until:y,day:r,day_of_week:i,day_of_month:a,day_of_year:u,offset_from_pascha:p}[t]},n.prototype.getData=function(){var t,e,n,r,a,i;return n=this.data.type,i=function(){var i,u,o,s,p,c,l,h,d;switch(n){case"count":return this.children[0].getData();case"until":return this.children[0].getData();case"day_of_week":for(r={},p=this.children,i=0,o=p.length;o>i;i++)t=p[i],c=t.getData(),e=c[0],a=c[1],(l=r[e])==null&&(r[e]=[]),r[e].push(a);return r;default:for(h=this.children,d=[],u=0,s=h.length;s>u;u++)t=h[u],d.push(t.getData());return d}}.call(this),r={},r[n]=i,r},n.prototype.destroyable=function(){return!0},n.prototype.render=function(){var e,r,a,i=this;return r='<div class="Validation">\n  '+(this.parent.children.indexOf(this)>0?"and if":"If")+" <select>\n    "+o.option("count","event occured less than",this.data.type)+"\n    "+o.option("until","event is before",this.data.type)+"\n    "+o.option("day","is this day of the week",this.data.type),((a=this.parent.data.rule_type)==="IceCube::YearlyRule"||a==="IceCube::MonthlyRule")&&(r+=o.option("day_of_week","is this day of the nth week",this.data.type),r+=o.option("day_of_month","is the nth day of the month",this.data.type)),this.parent.data.rule_type==="IceCube::YearlyRule"&&(r+=o.option("day_of_year","is the nth day of the year",this.data.type),r+=o.option("offset_from_pascha","is offset from Pascha",this.data.type)),r+="  </select>\n</div>",e=t(r),e.find("select").change(function(t){var e;return e=i.choices(t.target.value),i.children=[new e(i)],i.data.type=t.target.value,i.triggerRender()}),e.append(n.__super__.render.apply(this,arguments))},n}(),g=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){return this.data.value=this["default"]},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.getData=function(){return this.data.value},e.prototype.dataTransformer=parseInt,e.prototype["default"]=1,e.prototype.render=function(){var n,r=this;return n=t(this.html()),n.find("input,select").change(function(t){return r.data.value=r.dataTransformer(t.target.value)}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),e=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,g),t.prototype.clonable=function(){return!1},t.prototype.html=function(){return'<div class="Count">\n  <input type="number" value='+this.data.value+" /> times.\n</div>"},t}(),y=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t.prototype.getData=function(){return this.data.time},t.prototype.clonable=function(){return!1},t.prototype.destroyable=function(){return!1},t}(),a=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,g),t.prototype.html=function(){var t,e,n;for(e=function(t){switch(t>10&&20>t?4:t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},n='<div class="DayOfMonth">\n  <select>',t=1;31>=t;t++)n+=o.option(t+"",""+t+e(t),this.data.value+"");return n+=o.option("-1","last",this.data.value+""),n+="</select> day of the month.\n</div>"},t}(),r=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,g),t.prototype.html=function(){var t,e,n,r,a;for(n='<div class="Day">\n  <select>',a=o.daysOfTheWeek,e=0,r=a.length;r>e;e++)t=a[e],n+=o.option(e+"",t,this.data.value+"");return n+="</select>\n</div>"},t}(),i=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return[this.data.day,this.data.nth]},e.prototype.fromData=function(t){this.data=t},e.prototype.defaults=function(){return this.data.nth=1,this.data.day=0},e.prototype.render=function(){var n,r,a,i,u,s,p,c=this;for(u='<div class="DayOfWeek">\n  <input type="number" value='+this.data.nth+" /><span>nth</span>.\n  <select>",p=o.daysOfTheWeek,a=0,s=p.length;s>a;a++)r=p[a],u+=o.option(a+"",r,this.data.day+"");return u+="</select></div>",n=t(u),i=function(){return n.find("span").first().text(function(){switch(this.data.nth){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}.call(c))},n.find("input").change(function(t){return c.data.nth=parseInt(t.target.value),i()}),n.find("select").change(function(t){return c.data.day=parseInt(t.target.value)}),i(),n.append(e.__super__.render.apply(this,arguments)),n},e}(),u=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return this.data.value},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.defaults=function(){return this.data.value=1},e.prototype.render=function(){var n,r,a=this;return r='<div class="DayOfYear">\n  <input type="number" value='+Math.abs(this.data.value)+" /> day from the \n  <select>\n    "+o.option("+","beggening",function(){return a.data.value>=0})+"\n    "+o.option("-","end",function(){return 0>a.data.value})+"\n  </select> of the year.</div>",n=t(r),n.find("input,select").change(function(){return a.data.value=parseInt(n.find("input").val()),a.data.value*=n.find("select").val()==="+"?1:-1}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),p=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return this.data.value},e.prototype.defaults=function(){return this.data.value=0},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.render=function(){var n,r,a=this;return r='<div class="OffsetFromPascha">\n  <input type="number" value='+Math.abs(this.data.value)+" /> days \n  <select>\n    "+o.option("+","after",function(){return a.data.value>=0})+"\n    "+o.option("-","before",function(){return 0>a.data.value})+"\n  </select> Pascha.</div>",n=t(r),n.find("input,select").change(function(){return a.data.value=parseInt(n.find("input").val()),a.data.value*=n.find("select").val()==="+"?1:-1}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),s=function(){function t(t,e){var n,r=this;n=function(){try{return JSON.parse(t.val())}catch(e){return null}}(),this.root=new l(t,n),t.parents("form").on("submit",function(n){return e.submit?(e.submit(r.getData()),n.preventDefault(),!1):t.val(JSON.stringify(r.getData()))}),t.after(this.root.render())}return t.prototype.getData=function(){return this.root.getData()},t}(),t.fn.icui=function(e){return e==null&&(e={}),this.each(function(){return new s(t(this),e)})}})($)