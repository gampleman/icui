Date.prototype.strftime===void 0&&(Date.prototype.strftime=function(){function t(t){return t.getDate()+""}function e(t){return t.getDay()+""}function n(t){return((t.getTime()-R.start_of_year.getTime())/S+1+"").split(/\./)[0]}function r(e){return("0"+t(e)).slice(-2)}function a(t){return t.toLocaleString()}function i(t){return t.toLocaleDateString()}function u(t){return t.toLocaleTimeString()}function o(t){var e=t.getHours();return e===0?e=12:e>12&&(e-=12),e+""}function s(t){return t.getHours()}function p(t){return("0"+s(t)).slice(-2)}function c(t){return("0"+o(t)).slice(-2)}function l(t){return t.getHours()>=12?"pm":"am"}function h(t){return l(t).toUpperCase()}function d(t){return("0"+t.getMinutes()).slice(-2)}function f(t){return("0"+(t.getMonth()+1)).slice(-2)}function y(t){return I[t.getMonth()]}function _(t){return C[t.getMonth()]}function v(t){return("0"+t.getSeconds()).slice(-2)}function g(t){var e=t.getTimezoneOffset();return(e>=0?"-":"")+("0"+e/60).slice(-2)+":"+("0"+e%60).slice(-2)}function m(t){return("0"+Math.round(parseInt(n(t),10)/7)).slice(-2)}function D(t){return T[t.getDay()]}function w(t){return O[t.getDay()]}function b(t){return t.getFullYear()+""}function x(t){return b(t).slice(-2)}function k(t){var e,n=t;R.start_of_year=new Date("Jan 1 "+this.getFullYear());while(e=M.exec(t))e[1]in F&&(n=n.replace(RegExp(e[0],"mg"),F[e[1]](this)));return n}var R={start_of_year:new Date("Jan 1 "+(new Date).getFullYear())},M=/%([a-z]|%)/gim,S=864e5,T=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],I=["January","February","March","April","May","June","July","August","September","October","November","December"],O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F={a:w,A:D,b:_,B:y,c:a,d:r,e:t,H:p,I:c,j:n,k:s,l:o,m:f,M:d,p:h,P:l,S:v,U:m,w:e,x:i,X:u,y:x,Y:b,z:g,"%":function(){return"%"}};return k}());var __hasProp=Object.prototype.hasOwnProperty,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(t){var e,n,r,a,i,u,o,s,p,c,l,h,d,f,y,_,v,g;return t==null&&(t=jQuery),o={clone:v=function(t){var e,n,r;if(t==null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return e="",t.global!=null&&(e+="g"),t.ignoreCase!=null&&(e+="i"),t.multiline!=null&&(e+="m"),t.sticky!=null&&(e+="y"),RegExp(t.source,e);t.parent!=null&&t.data!=null?(r=new t.constructor(t.parent,"__clone"),r.data=v(t.data)):r=new t.constructor;for(n in t)__hasProp.call(t,n)&&n!=="parent"&&n!=="data"&&typeof t[n]!="function"&&(r[n]=v(t[n]));return r},option:function(t,e,n){return typeof n=="Function"?'<option value="'+t+'"'+(n(t)?' selected="selected"':"")+">"+e+"</option>":'<option value="'+t+'"'+(n===t?' selected="selected"':"")+">"+e+"</option>"},daysOfTheWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateFromString:function(t){var e;return e=new Date,e.setTime(Date.parse(t)),e}},g=function(t){return t?' selected="selected"':""},c=function(){function e(t,e){this.parent=t,e==null&&(e=null),this.destroy=__bind(this.destroy,this),this.clone=__bind(this.clone,this),this.children=[],this.data={},e!=="__clone"&&(e?this.fromData(e):this.defaults())}return e.prototype.fromData=function(){},e.prototype.defaults=function(){},e.prototype.clonable=function(){return!0},e.prototype.destroyable=function(){return this.parent.children.length>1},e.prototype.clone=function(){return this.parent.children.push(o.clone(this)),this.triggerRender()},e.prototype.destroy=function(){return this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.triggerRender()},e.prototype.render=function(){var e;return e=t("<div></div>"),this.clonable()&&e.append(t("<span class='btn clone'>+</span>").click(this.clone)),this.destroyable()&&e.append(t("<span class='btn destroy'>-</span>").click(this.destroy)),e.append(this.renderChildren()),e.children()},e.prototype.renderChildren=function(){var t,e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.render());return a},e.prototype.triggerRender=function(){return this.parent.triggerRender()},e}(),l=function(){function t(){t.__super__.constructor.apply(this,arguments),this.parent.after("<div class='icui'></div>"),this.target=this.parent.siblings(".icui").first()}return __extends(t,c),t.prototype.clonable=function(){return!1},t.prototype.destroyable=function(){return!1},t.prototype.fromData=function(t){var e,n,r;this.children.push(new d(this,t.start_date)),r=[];for(e in t)n=t[e],n.length>0&&e!=="start_date"&&r.push(this.children.push(new f(this,{type:e,values:n})));return r},t.prototype.defaults=function(){return this.children.push(new d(this)),this.children.push(new f(this))},t.prototype.triggerRender=function(){return this.render()},t.prototype.render=function(){return this.target.html(this.renderChildren())},t.prototype.getData=function(){var t,e,n,r,a,i;for(n={},i=this.children,r=0,a=i.length;a>r;r++)t=i[r],e=t.getData(),n[e.type]=n[e.type]?n[e.type].concat(e.values):e.values;return n},t}(),f=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.destroyable=function(){return this.parent.children.length>2},e.prototype.defaults=function(){return this.data.type="rtimes",this.children=[new n(this)]},e.prototype.fromData=function(t){var e,r,a,i,u,o,s,p,c;if(this.data.type=t.type,this.data.type.match(/times$/)){for(o=t.values,p=[],r=0,i=o.length;i>r;r++)e=o[r],p.push(this.children.push(new n(this,e)));return p}for(s=t.values,c=[],a=0,u=s.length;u>a;a++)e=s[a],c.push(this.children.push(new h(this,e)));return c},e.prototype.getData=function(){var t,e;return this.data.type.match(/times$/)?(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData().time);return a}.call(this),{type:this.data.type,values:e}):(e=function(){var e,n,r,a;for(r=this.children,a=[],e=0,n=r.length;n>e;e++)t=r[e],a.push(t.getData());return a}.call(this),{type:this.data.type,values:e})},e.prototype.render=function(){var r,a,i=this;return r=t('<div class="toplevel">Event <select>\n  <option value="1"'+g(this.data.type.match(/^r/))+'>occurs</option>\n  <option value="-1"'+g(this.data.type.match(/^ex/))+'>doesn\'t occur</option>\n</select> on <select>\n  <option value="dates"'+g(this.data.type.match(/times$/))+'>specific dates</option>\n  <option value="rule"'+g(this.data.type.match(/rules$/))+">every</option>\n</select>\n</div>"),a=r.find("select"),a.first().change(function(t){return i.data.type=t.target.value==="1"?i.data.type.replace(/^ex/,"r"):i.data.type.replace(/^r/,"ex")}),a.last().change(function(t){return t.target.value==="dates"?(i.data.type=i.data.type.match(/^r/)?"rtimes":"extimes",i.children=[new n(i)]):(i.data.type=i.data.type.match(/^r/)?"rrules":"exrules",i.children=[new h(i)]),i.triggerRender()}),r.append(e.__super__.render.apply(this,arguments)),r},e}(),n=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){var t,e;return(e=(t=this.data).time)!=null?e:t.time=new Date},e.prototype.fromData=function(t){return this.data.time=o.dateFromString(t)},e.prototype.getData=function(){return this.data},e.prototype.render=function(){var n,r,a,i,u=this;return n=t('<div class="DatePicker">\n  <input type="date" value="'+this.data.time.strftime("%Y-%m-%d")+'" />\n  <input type="time" value="'+this.data.time.strftime("%H:%M")+'" />\n</div>'),a=n.find("input"),r=a.first(),i=a.last(),a.change(function(){return u.data.time=o.dateFromString(r.val()+" "+i.val())}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),d=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t.prototype.destroyable=function(){return!1},t.prototype.clonable=function(){return!1},t.prototype.getData=function(){return{type:"start_date",values:this.data.time}},t.prototype.render=function(){var e;return e=t.__super__.render.apply(this,arguments),e.prepend("Start time"),e},t}(),h=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){return this.data.rule_type="IceCube::YearlyRule",this.children=[new y(this)],this.data.interval=1},e.prototype.fromData=function(t){var e,n,r,a;this.data.rule_type=t.rule_type,this.data.interval=t.interval,r=t.validations,a=[];for(e in r)n=r[e],a.push(this.children.push(new y(this,{type:e,value:n})));return a},e.prototype.getData=function(){var t,e,n,r,a,i,u,o;for(r={},u=this.children,a=0,i=u.length;i>a;a++){t=u[a],o=t.getData();for(e in o)n=o[e],r[e]=n}return{rule_type:this.data.rule_type,interval:this.data.interval,validations:r}},e.prototype.render=function(){var n,r=this;return n=t('<div class="Rule">\n  Every \n  <input type="number" value="'+this.data.interval+'" size="2" width="30" />\n  <select>\n    '+o.option("IceCube::YearlyRule","years",this.data.rule_type)+"\n    "+o.option("IceCube::MonthlyRule","months",this.data.rule_type)+"\n    "+o.option("IceCube::WeeklyRule","weeks",this.data.rule_type)+"\n    "+o.option("IceCube::DailyRule","days",this.data.rule_type)+"\n  </select>\n</div>"),n.find("input").change(function(t){return r.data.interval=parseInt(t.target.value)}),n.find("select").change(function(t){return r.data.rule_type=t.target.value,r.children=[new y(r)],r.triggerRender()}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),y=function(){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,c),n.prototype.defaults=function(){return this.data.type="count",this.children=[new e(this)]},n.prototype.fromData=function(t){var n,a,u,o,s,p,c,l,h;switch(this.data.type=t.type,t.type){case"count":return this.children.push(new e(this,t.value));case"day":for(p=t.value,l=[],o=0,s=p.length;s>o;o++)a=p[o],l.push(this.children.push(new r(this,a)));return l;case"day_of_week":c=t.value,h=[];for(n in c)u=c[n],h.push(function(){var t,e,r;for(r=[],t=0,e=u.length;e>t;t++)a=u[t],r.push(this.children.push(new i(this,{nth:a,day:n})));return r}.call(this));return h}},n.prototype.getData=function(){var t,e,n,r,a,i;return n=this.data.type,i=function(){var i,u,o,s,p,c,l,h,d;switch(n){case"count":return this.children[0].getData();case"day_of_week":for(r={},p=this.children,i=0,o=p.length;o>i;i++)t=p[i],c=t.getData(),e=c[0],a=c[1],(l=r[e])==null&&(r[e]=[]),r[e].push(a);return r;default:for(h=this.children,d=[],u=0,s=h.length;s>u;u++)t=h[u],d.push(t.getData());return d}}.call(this),r={},r[n]=i,r},n.prototype.render=function(){var s,c,l,h=this;return c='<div class="Validation">\n  '+(this.parent.children.indexOf(this)>0?"and if":"If")+" <select>\n    "+o.option("count","event occured less than",this.data.type)+"\n    "+o.option("day","is this day of the week",this.data.type),((l=this.parent.data.rule_type)==="IceCube::YearlyRule"||l==="IceCube::MonthlyRule")&&(c+=o.option("day_of_week","is this day of the nth week",this.data.type),c+=o.option("day_of_month","is the nth day of the month",this.data.type)),this.parent.data.rule_type==="IceCube::YearlyRule"&&(c+=o.option("day_of_year","is the nth day of the year",this.data.type),c+=o.option("offset_from_pascha","is offset from Pascha",this.data.type)),c+="  </select>\n</div>",s=t(c),s.find("select").change(function(t){switch(t.target.value){case"count":h.children=[new e(h)];break;case"day":h.children=[new r(h)];break;case"day_of_week":h.children=[new i(h)];break;case"day_of_month":h.children=[new a(h)];break;case"day_of_year":h.children=[new u(h)];break;case"offset_from_pascha":h.children=[new p(h)]}return h.data.type=t.target.value,h.triggerRender()}),s.append(n.__super__.render.apply(this,arguments))},n}(),_=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.defaults=function(){return this.data.value=this["default"]},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.getData=function(){return this.data.value},e.prototype.dataTransformer=function(t){return t},e.prototype.render=function(){var n,r=this;return n=t(this.html()),n.find("input,select").change(function(t){return r.data.value=r.dataTransformer(t.target.value)}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),e=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,_),t.prototype["default"]=1,t.prototype.clonable=function(){return!1},t.prototype.html=function(){return'<div class="Count">\n  <input type="number" value='+this.data.value+" /> times.\n</div>"},t}(),a=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,_),t.prototype["default"]=1,t.prototype.dataTransformer=parseInt,t.prototype.html=function(){var t,e,n;for(e=function(t){switch(t>10&&20>t?4:t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},n='<div class="DayOfMonth">\n  <select>',t=1;31>=t;t++)n+=o.option(t+"",""+t+e(t),this.data.value+"");return n+=o.option("-1","last",this.data.value+""),n+="</select> day of the month.\n</div>"},t}(),r=function(){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,_),t.prototype["default"]=0,t.prototype.dataTransformer=parseInt,t.prototype.html=function(){var t,e,n,r,a;for(n='<div class="Day">\n  <select>',a=o.daysOfTheWeek,e=0,r=a.length;r>e;e++)t=a[e],n+=o.option(e+"",t,this.data.value+"");return n+="</select>\n</div>"},t}(),i=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return[this.data.day,this.data.nth]},e.prototype.fromData=function(t){this.data=t},e.prototype.defaults=function(){return this.data.nth=1,this.data.day=0},e.prototype.render=function(){var n,r,a,i,u,s,p,c=this;for(u='<div class="DayOfWeek">\n  <input type="number" value='+this.data.nth+" /><span>nth</span>.\n  <select>",p=o.daysOfTheWeek,a=0,s=p.length;s>a;a++)r=p[a],u+=o.option(a+"",r,this.data.day+"");return u+="</select></div>",n=t(u),i=function(){return n.find("span").first().text(function(){switch(this.data.nth){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}.call(c))},n.find("input").change(function(t){return c.data.nth=parseInt(t.target.value),i()}),n.find("select").change(function(t){return c.data.day=parseInt(t.target.value)}),i(),n.append(e.__super__.render.apply(this,arguments)),n},e}(),u=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return this.data.value},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.defaults=function(){return this.data.value=1},e.prototype.render=function(){var n,r,a=this;return r='<div class="DayOfYear">\n  <input type="number" value='+Math.abs(this.data.value)+" /> day from the \n  <select>\n    "+o.option("+","beggening",function(){return this.data.value>=0})+"\n    "+o.option("-","end",function(){return 0>this.data.value})+"\n  </select> of the year.</div>",n=t(r),n.find("input,select").change(function(){return a.data.value=parseInt(n.find("input").val()),a.data.value*=n.find("select").val()==="+"?1:-1}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),p=function(){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,c),e.prototype.getData=function(){return this.data.value},e.prototype.fromData=function(t){return this.data.value=t},e.prototype.defaults=function(){return this.data.value=0},e.prototype.render=function(){var n,r,a=this;return r='<div class="OffsetFromPascha">\n  <input type="number" value='+Math.abs(this.data.value)+" /> days \n  <select>\n    "+o.option("+","after",function(){return this.data.value>=0})+"\n    "+o.option("-","before",function(){return 0>this.data.value})+"\n  </select> Pascha.</div>",n=t(r),n.find("input,select").change(function(){return a.data.value=parseInt(n.find("input").val()),a.data.value*=n.find("select").val()==="+"?1:-1}),n.append(e.__super__.render.apply(this,arguments)),n},e}(),s=function(){function t(t){var e=this;try{this.root=new l(t,JSON.parse(t.val()))}catch(n){this.root=new l(t)}t.parent("form").on("submit",function(){return t.val(JSON.stringify(e.getData()))}),t.after(this.root.render())}return t.prototype.getData=function(){return this.root.getData()},t}(),t.fn.icui=function(){return this.each(function(){return new s(t(this))})}})($)