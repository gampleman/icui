<!DOCTYPE html>  <html> <head>   <title>icui.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               icui.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">do</span> <span class="nf">($ = jQuery) -&gt;</span>
  <span class="nv">Helpers = </span>
    <span class="nv">clone: clone = </span><span class="nf">(obj) -&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">obj</span><span class="o">?</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">isnt</span> <span class="s">&#39;object&#39;</span>
        <span class="k">return</span> <span class="nx">obj</span>

      <span class="k">if</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Date</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">getTime</span><span class="p">())</span> 

      <span class="k">if</span> <span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">RegExp</span>
        <span class="nv">flags = </span><span class="s">&#39;&#39;</span>
        <span class="nx">flags</span> <span class="o">+=</span> <span class="s">&#39;g&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">global</span><span class="o">?</span>
        <span class="nx">flags</span> <span class="o">+=</span> <span class="s">&#39;i&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">ignoreCase</span><span class="o">?</span>
        <span class="nx">flags</span> <span class="o">+=</span> <span class="s">&#39;m&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">multiline</span><span class="o">?</span>
        <span class="nx">flags</span> <span class="o">+=</span> <span class="s">&#39;y&#39;</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">sticky</span><span class="o">?</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> 

      <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">parent</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span>
        <span class="nv">newInstance = </span><span class="k">new</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span> <span class="s">&#39;__clone&#39;</span><span class="p">)</span>
        <span class="nv">newInstance.data = </span><span class="nx">clone</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">data</span>
      <span class="k">else</span>
        <span class="nv">newInstance = </span><span class="k">new</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">()</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">obj</span> <span class="k">when</span> <span class="nx">key</span> <span class="o">not</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;parent&#39;</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">]</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;function&#39;</span>
        <span class="nx">newInstance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">clone</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>

      <span class="k">return</span> <span class="nx">newInstance</span>
  
    <span class="nv">option: </span><span class="nf">(value, name, variable) -&gt;</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">variable</span> <span class="o">==</span> <span class="s">&#39;Function&#39;</span>
        <span class="s">&quot;&quot;&quot;&lt;option value=&quot;</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&quot;</span><span class="si">#{</span><span class="k">if</span> <span class="nx">variable</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="k">then</span> <span class="s">&#39; selected=&quot;selected&quot;&#39;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="si">}</span><span class="s">&gt;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&lt;/option&gt;&quot;&quot;&quot;</span> 
      <span class="k">else</span>
        <span class="s">&quot;&quot;&quot;&lt;option value=&quot;</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&quot;</span><span class="si">#{</span><span class="k">if</span> <span class="nx">variable</span> <span class="o">==</span> <span class="nx">value</span> <span class="k">then</span> <span class="s">&#39; selected=&quot;selected&quot;&#39;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="si">}</span><span class="s">&gt;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&lt;/option&gt;&quot;&quot;&quot;</span>  
    
    <span class="nv">daysOfTheWeek: </span><span class="p">[</span><span class="s">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s">&quot;Monday&quot;</span><span class="p">,</span> <span class="s">&quot;Tuesday&quot;</span><span class="p">,</span> <span class="s">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s">&quot;Thursday&quot;</span><span class="p">,</span> <span class="s">&quot;Friday&quot;</span><span class="p">,</span> <span class="s">&quot;Saturday&quot;</span><span class="p">]</span>
  
    <span class="nv">dateFromString: </span><span class="nf">(str) -&gt;</span>
      <span class="nv">d = </span><span class="k">new</span> <span class="nb">Date</span>
      <span class="nx">d</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">))</span>
      <span class="nx">d</span>
  

  <span class="nv">selectedIf = </span><span class="nf">(bool) -&gt;</span> <span class="k">if</span> <span class="nx">bool</span> <span class="k">then</span> <span class="s">&#39; selected=&quot;selected&quot;&#39;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>

  <span class="k">class</span> <span class="nx">Option</span>
  
    <span class="nv">constructor: </span><span class="nf">(@parent, data = null) -&gt;</span> 
      <span class="vi">@children = </span><span class="p">[]</span>
      <span class="vi">@data = </span><span class="p">{}</span>
      <span class="k">if</span> <span class="nx">data</span> <span class="o">!=</span> <span class="s">&#39;__clone&#39;</span>
        <span class="k">if</span> <span class="nx">data</span> <span class="k">then</span> <span class="nx">@fromData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@defaults</span><span class="p">()</span>
    
    <span class="nv">fromData: </span><span class="nf">(data) -&gt;</span>
  
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
    
    <span class="nv">clonable: </span><span class="o">-&gt;</span> <span class="kc">true</span>
    
    <span class="nv">destroyable: </span><span class="o">-&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
  
    <span class="nv">clone: </span><span class="o">=&gt;</span> 
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">@</span>
      <span class="nx">@triggerRender</span><span class="p">()</span>
  
    <span class="nv">destroy: </span><span class="o">=&gt;</span> 
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">triggerRender</span><span class="p">()</span>
  
    <span class="nv">render: </span><span class="o">-&gt;</span> 
      <span class="nv">out = </span><span class="nx">$</span> <span class="s">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">append</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;span class=&#39;btn clone&#39;&gt;+&lt;/span&gt;&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">@clone</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@clonable</span><span class="p">()</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">append</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;span class=&#39;btn destroy&#39;&gt;-&lt;/span&gt;&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">@destroy</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@destroyable</span><span class="p">()</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">append</span> <span class="nx">@renderChildren</span><span class="p">()</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">children</span><span class="p">()</span>
    
    <span class="nv">renderChildren: </span><span class="o">-&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span> <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">@children</span>
  
    <span class="nv">triggerRender: </span><span class="o">-&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">triggerRender</span><span class="p">()</span>
  
  
  <span class="k">class</span> <span class="nx">Root</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">clonable: </span><span class="o">-&gt;</span> <span class="kc">false</span>
    <span class="nv">destroyable: </span><span class="o">-&gt;</span> <span class="kc">false</span>
  
    <span class="nv">constructor: </span><span class="o">-&gt;</span>
      <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>@children.push new TopLevel(@)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@parent</span><span class="p">.</span><span class="nx">after</span> <span class="s">&quot;&lt;div class=&#39;icui&#39;&gt;&lt;/div&gt;&quot;</span>
      <span class="vi">@target = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="s">&#39;.icui&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">()</span>
    
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">StartDate</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">d</span><span class="p">[</span><span class="s">&quot;start_date&quot;</span><span class="p">])</span>
      <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">d</span> <span class="k">when</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">k</span> <span class="o">!=</span> <span class="s">&quot;start_date&quot;</span>
        <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">TopLevel</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="p">{</span><span class="nv">type: </span><span class="nx">k</span><span class="p">,</span> <span class="nv">values: </span><span class="nx">v</span><span class="p">})</span>
  
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">StartDate</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">TopLevel</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
  
    <span class="nv">triggerRender: </span><span class="o">-&gt;</span> <span class="nx">@render</span><span class="p">()</span>
  
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">@renderChildren</span><span class="p">())</span>
    
    <span class="nv">getData: </span><span class="o">-&gt;</span>
      <span class="nv">data = </span><span class="p">{}</span>
      <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span>
        <span class="nv">d = </span><span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">data</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">values</span>
      <span class="nx">data</span>
    
  
  <span class="k">class</span> <span class="nx">TopLevel</span> <span class="k">extends</span> <span class="nx">Option</span>
  
    <span class="nv">destroyable: </span><span class="o">-&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span>
  
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="vi">@data.type = </span><span class="s">&#39;rtimes&#39;</span>
      <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">DatePicker</span> <span class="nx">@</span><span class="p">]</span>
  
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span>
      <span class="vi">@data.type = </span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span>
      <span class="k">if</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/times$/</span>  
        <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">d</span><span class="p">.</span><span class="nx">values</span>
          <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">DatePicker</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">v</span>
      <span class="k">else</span>
        <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">d</span><span class="p">.</span><span class="nx">values</span>
          <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Rule</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">v</span>
    <span class="nv">getData: </span><span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/times$/</span>
        <span class="nv">values = </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">time</span> <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span><span class="p">)</span>
        <span class="p">{</span><span class="nv">type: </span><span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">values</span><span class="p">}</span>
      <span class="k">else</span>
        <span class="nv">values = </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span> <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span><span class="p">)</span>
        <span class="p">{</span><span class="nv">type: </span><span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">values</span><span class="p">}</span>
      
  
    <span class="nv">render: </span><span class="o">-&gt;</span> 
      <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    &lt;div class=&quot;toplevel&quot;&gt;Event &lt;select&gt;</span>
<span class="s">      &lt;option value=&quot;1&quot;</span><span class="si">#{</span><span class="nx">selectedIf</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/^r/</span><span class="si">}</span><span class="s">&gt;occurs&lt;/option&gt;</span>
<span class="s">      &lt;option value=&quot;-1&quot;</span><span class="si">#{</span><span class="nx">selectedIf</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/^ex/</span><span class="si">}</span><span class="s">&gt;doesn&#39;t occur&lt;/option&gt;</span>
<span class="s">    &lt;/select&gt; on &lt;select&gt;</span>
<span class="s">      &lt;option value=&quot;dates&quot;</span><span class="si">#{</span><span class="nx">selectedIf</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/times$/</span><span class="si">}</span><span class="s">&gt;specific dates&lt;/option&gt;</span>
<span class="s">      &lt;option value=&quot;rule&quot;</span><span class="si">#{</span><span class="nx">selectedIf</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/rules$/</span><span class="si">}</span><span class="s">&gt;every&lt;/option&gt;</span>
<span class="s">    &lt;/select&gt;</span>
<span class="s">    &lt;/div&gt;</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">)</span>
      <span class="nv">ss = </span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">)</span>
      <span class="nx">ss</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span>
            <span class="vi">@data.type = </span><span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/^ex/</span><span class="p">,</span> <span class="s">&#39;r&#39;</span>
        <span class="k">else</span>
          <span class="vi">@data.type = </span><span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/^r/</span><span class="p">,</span> <span class="s">&#39;ex&#39;</span>
      <span class="nx">ss</span><span class="p">.</span><span class="nx">last</span><span class="p">().</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s">&#39;dates&#39;</span>
          <span class="k">if</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/^r/</span>
            <span class="vi">@data.type = </span><span class="s">&#39;rtimes&#39;</span>
          <span class="k">else</span>
            <span class="vi">@data.type = </span><span class="s">&#39;extimes&#39;</span>
          <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">DatePicker</span> <span class="nx">@</span><span class="p">]</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/^r/</span>
            <span class="vi">@data.type = </span><span class="s">&#39;rrules&#39;</span>
          <span class="k">else</span>
            <span class="vi">@data.type = </span><span class="s">&#39;exrules&#39;</span>
          <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Rule</span> <span class="nx">@</span><span class="p">]</span>
        <span class="nx">@triggerRender</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span> <span class="k">super</span>
      <span class="nx">$el</span>

  <span class="k">class</span> <span class="nx">DatePicker</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="nx">@data</span><span class="p">.</span><span class="nx">time</span> <span class="o">?=</span> <span class="k">new</span> <span class="nb">Date</span>
    
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span>  <span class="vi">@data.time = </span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">dateFromString</span> <span class="nx">d</span>
    
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="nx">@data</span>
    <span class="nv">render: </span><span class="o">-&gt;</span> 
      <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        &lt;div class=&quot;DatePicker&quot;&gt;</span>
<span class="s">          &lt;input type=&quot;date&quot; value=&quot;</span><span class="si">#{</span><span class="nx">@data</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-%d&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot; /&gt;</span>
<span class="s">          &lt;input type=&quot;time&quot; value=&quot;</span><span class="si">#{</span><span class="nx">@data</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">strftime</span><span class="p">(</span><span class="s">&#39;%H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot; /&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>
      <span class="nv">ss = </span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
      <span class="nv">date = </span><span class="nx">ss</span><span class="p">.</span><span class="nx">first</span><span class="p">()</span>
      <span class="nv">time = </span><span class="nx">ss</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span>
      <span class="nx">ss</span><span class="p">.</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.time = </span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">dateFromString</span> <span class="nx">date</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nx">time</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span> <span class="k">super</span>
      <span class="nx">$el</span>

  <span class="k">class</span> <span class="nx">StartDate</span> <span class="k">extends</span> <span class="nx">DatePicker</span>
    <span class="nv">destroyable: </span><span class="o">-&gt;</span> <span class="kc">false</span>
    <span class="nv">clonable: </span><span class="o">-&gt;</span> <span class="kc">false</span>
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="p">{</span><span class="nv">type: </span><span class="s">&quot;start_date&quot;</span><span class="p">,</span> <span class="nv">values: </span><span class="nx">@data</span><span class="p">.</span><span class="nx">time</span><span class="p">}</span>
  
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">$el = </span><span class="k">super</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="s">&quot;Start time&quot;</span><span class="p">)</span>
      <span class="nx">$el</span>
    
  <span class="k">class</span> <span class="nx">Rule</span> <span class="k">extends</span> <span class="nx">Option</span>
  
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="vi">@data.rule_type = </span><span class="s">&#39;IceCube::YearlyRule&#39;</span>
      <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Validation</span> <span class="nx">@</span><span class="p">]</span>
      <span class="vi">@data.interval = </span><span class="mi">1</span>
    
    <span class="nv">fromData: </span><span class="nf">(d)-&gt;</span>
      <span class="vi">@data.rule_type = </span><span class="nx">d</span><span class="p">.</span><span class="nx">rule_type</span>
      <span class="vi">@data.interval = </span><span class="nx">d</span><span class="p">.</span><span class="nx">interval</span>
      <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">d</span><span class="p">.</span><span class="nx">validations</span>
        <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Validation</span> <span class="nx">@</span><span class="p">,</span> <span class="p">{</span><span class="nv">type: </span><span class="nx">k</span><span class="p">,</span> <span class="nv">value: </span><span class="nx">v</span><span class="p">}</span>
  
    <span class="nv">getData: </span><span class="o">-&gt;</span>
      <span class="nv">validations = </span><span class="p">{}</span>
      <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span>
        <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
          <span class="nx">validations</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
      <span class="p">{</span><span class="nv">rule_type: </span><span class="nx">@data</span><span class="p">.</span><span class="nx">rule_type</span><span class="p">,</span> <span class="nv">interval: </span><span class="nx">@data</span><span class="p">.</span><span class="nx">interval</span><span class="p">,</span> <span class="nx">validations</span><span class="p">}</span>
    
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        &lt;div class=&quot;Rule&quot;&gt;</span>
<span class="s">          Every </span>
<span class="s">          &lt;input type=&quot;number&quot; value=&quot;</span><span class="si">#{</span><span class="nx">@data</span><span class="p">.</span><span class="nx">interval</span><span class="si">}</span><span class="s">&quot; size=&quot;2&quot; width=&quot;30&quot; /&gt;</span>
<span class="s">          &lt;select&gt;</span>
<span class="s">            </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;IceCube::YearlyRule&quot;</span><span class="p">,</span> <span class="s">&#39;years&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">rule_type</span><span class="si">}</span><span class="s"></span>
<span class="s">            </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;IceCube::MonthlyRule&quot;</span><span class="p">,</span> <span class="s">&#39;months&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">rule_type</span><span class="si">}</span><span class="s"></span>
<span class="s">            </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;IceCube::WeeklyRule&quot;</span><span class="p">,</span> <span class="s">&#39;weeks&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">rule_type</span><span class="si">}</span><span class="s"></span>
<span class="s">            </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;IceCube::DailyRule&quot;</span><span class="p">,</span> <span class="s">&#39;days&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">rule_type</span><span class="si">}</span><span class="s"></span>
<span class="s">          &lt;/select&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.interval = </span><span class="nb">parseInt</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.rule_type = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
        <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Validation</span> <span class="nx">@</span><span class="p">]</span>
        <span class="nx">@triggerRender</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span> <span class="k">super</span>
      <span class="nx">$el</span>
    
  <span class="k">class</span> <span class="nx">Validation</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="vi">@data.type = </span><span class="s">&#39;count&#39;</span>
      <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Count</span> <span class="nx">@</span><span class="p">]</span>
    
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span>
      <span class="vi">@data.type = </span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span>
      <span class="k">switch</span> <span class="nx">d</span><span class="p">.</span><span class="nx">type</span>
        <span class="k">when</span> <span class="s">&#39;count&#39;</span> <span class="k">then</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Count</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span>
        <span class="k">when</span> <span class="s">&#39;day&#39;</span>
          <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span>
            <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">Day</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">v</span>
        <span class="k">when</span> <span class="s">&#39;day_of_week&#39;</span>
          <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">vals</span> <span class="k">of</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span>
            <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">vals</span>
              <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="k">new</span> <span class="nx">DayOfWeek</span> <span class="nx">@</span><span class="p">,</span> <span class="p">{</span><span class="nv">nth: </span><span class="nx">v</span><span class="p">,</span> <span class="nv">day: </span><span class="nx">k</span><span class="p">}</span>
  
    <span class="nv">getData: </span><span class="o">-&gt;</span>
      <span class="nv">key = </span><span class="nx">@data</span><span class="p">.</span><span class="nx">type</span>
      <span class="nv">value = </span><span class="k">switch</span> <span class="nx">key</span>
        <span class="k">when</span> <span class="s">&#39;count&#39;</span> <span class="k">then</span> <span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getData</span><span class="p">()</span>
        <span class="k">when</span> <span class="s">&#39;day_of_week&#39;</span>
          <span class="nv">obj = </span><span class="p">{}</span>
          <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span>
            <span class="p">[</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">?=</span> <span class="p">[]</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">push</span> <span class="nx">v</span>
          <span class="nx">obj</span>
        <span class="k">else</span> <span class="nx">child</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span> <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@children</span>
      <span class="nv">obj = </span><span class="p">{}</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nx">obj</span>
    
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;Validation&quot;&gt;</span>
<span class="s">        </span><span class="si">#{</span><span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&quot;and if&quot;</span> <span class="k">else</span> <span class="s">&quot;If&quot;</span><span class="si">}</span><span class="s"> &lt;select&gt;</span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="s">&#39;event occured less than&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="s"></span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;day&quot;</span><span class="p">,</span> <span class="s">&#39;is this day of the week&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="s">&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">rule_type</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;IceCube::YearlyRule&quot;</span><span class="p">,</span> <span class="s">&quot;IceCube::MonthlyRule&quot;</span><span class="p">]</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;day_of_week&quot;</span><span class="p">,</span> <span class="s">&#39;is this day of the nth week&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span> 
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;day_of_month&quot;</span><span class="p">,</span> <span class="s">&#39;is the nth day of the month&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span>
      <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">rule_type</span> <span class="o">is</span> <span class="s">&quot;IceCube::YearlyRule&quot;</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;day_of_year&quot;</span><span class="p">,</span> <span class="s">&#39;is the nth day of the year&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;offset_from_pascha&quot;</span><span class="p">,</span> <span class="s">&#39;is offset from Pascha&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">type</span>
      <span class="nx">str</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        &lt;/select&gt;</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>
      <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
          <span class="k">when</span> <span class="s">&#39;count&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Count</span> <span class="nx">@</span><span class="p">]</span>
          <span class="k">when</span> <span class="s">&#39;day&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">Day</span> <span class="nx">@</span><span class="p">]</span>
          <span class="k">when</span> <span class="s">&#39;day_of_week&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">DayOfWeek</span> <span class="nx">@</span><span class="p">]</span>
          <span class="k">when</span> <span class="s">&#39;day_of_month&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">DayOfMonth</span> <span class="nx">@</span><span class="p">]</span>
          <span class="k">when</span> <span class="s">&#39;day_of_year&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">DayOfYear</span> <span class="nx">@</span><span class="p">]</span>
          <span class="k">when</span> <span class="s">&#39;offset_from_pascha&#39;</span> <span class="k">then</span> <span class="vi">@children = </span><span class="p">[</span><span class="k">new</span> <span class="nx">OffsetFromPascha</span> <span class="nx">@</span><span class="p">]</span>
        <span class="vi">@data.type = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
        <span class="nx">@triggerRender</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span> <span class="k">super</span>
  
  <span class="k">class</span> <span class="nx">ValidationInstance</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span> <span class="vi">@data.value = </span><span class="nx">@default</span>
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span> <span class="vi">@data.value = </span><span class="nx">d</span>
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span>
    <span class="nv">dataTransformer: </span><span class="nf">(a) -&gt;</span> <span class="nx">a</span>
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">$el = </span><span class="nx">$</span> <span class="nx">@html</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input,select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.value = </span><span class="nx">@dataTransformer</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="nx">$el</span>
  
  <span class="k">class</span> <span class="nx">Count</span> <span class="k">extends</span> <span class="nx">ValidationInstance</span>
    <span class="nv">default: </span><span class="mi">1</span>
    <span class="nv">clonable: </span><span class="o">-&gt;</span> <span class="kc">false</span>
    <span class="nv">html: </span><span class="o">-&gt;</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;Count&quot;&gt;</span>
<span class="s">        &lt;input type=&quot;number&quot; value=</span><span class="si">#{</span><span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="s"> /&gt; times.</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>

  <span class="k">class</span> <span class="nx">DayOfMonth</span> <span class="k">extends</span> <span class="nx">ValidationInstance</span>
    <span class="nv">default: </span><span class="mi">1</span>
  
    <span class="nv">dataTransformer: </span><span class="nb">parseInt</span>
    <span class="nv">html: </span><span class="o">-&gt;</span>
      <span class="nv">pluralize = </span><span class="nf">(n) -&gt;</span> <span class="k">switch</span> <span class="p">(</span><span class="k">if</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="k">then</span> <span class="mi">4</span> <span class="k">else</span> <span class="nx">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="s">&#39;st&#39;</span>
        <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="s">&#39;nd&#39;</span>
        <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="s">&#39;rd&#39;</span>
        <span class="k">else</span> <span class="s">&#39;th&#39;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;DayOfMonth&quot;&gt;</span>
<span class="s">        &lt;select&gt;&quot;&quot;&quot;</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">31</span><span class="p">]</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">i</span><span class="si">}#{</span><span class="nx">pluralize</span> <span class="nx">i</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span> <span class="s">&quot;last&quot;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">str</span> <span class="o">+=</span>  <span class="s">&quot;&quot;&quot;&lt;/select&gt; day of the month.</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>
    
  <span class="k">class</span> <span class="nx">Day</span> <span class="k">extends</span> <span class="nx">ValidationInstance</span>
    <span class="nv">default: </span><span class="mi">0</span>

    <span class="nv">dataTransformer: </span><span class="nb">parseInt</span>
    <span class="nv">html: </span><span class="o">-&gt;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;Day&quot;&gt;</span>
<span class="s">        &lt;select&gt;&quot;&quot;&quot;</span>
      <span class="k">for</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">daysOfTheWeek</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> 
      <span class="nx">str</span> <span class="o">+=</span>  <span class="s">&quot;&quot;&quot;&lt;/select&gt;</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>

  <span class="k">class</span> <span class="nx">DayOfWeek</span> <span class="k">extends</span> <span class="nx">Option</span>
  
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="p">[</span><span class="nx">@data</span><span class="p">.</span><span class="nx">day</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">nth</span><span class="p">]</span>
    <span class="nv">fromData: </span><span class="nf">(@data) -&gt;</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span>
      <span class="vi">@data.nth = </span><span class="mi">1</span>
      <span class="vi">@data.day = </span><span class="mi">0</span>

    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;DayOfWeek&quot;&gt;</span>
<span class="s">        &lt;input type=&quot;number&quot; value=</span><span class="si">#{</span><span class="nx">@data</span><span class="p">.</span><span class="nx">nth</span><span class="si">}</span><span class="s"> /&gt;&lt;span&gt;nth&lt;/span&gt;.</span>
<span class="s">        &lt;select&gt;&quot;&quot;&quot;</span>
      <span class="k">for</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">daysOfTheWeek</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">day</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> 
      <span class="nx">str</span> <span class="o">+=</span>  <span class="s">&quot;&lt;/select&gt;&lt;/div&gt;&quot;</span>
      <span class="nv">$el = </span><span class="nx">$</span> <span class="nx">str</span>
      <span class="nv">pluralize = </span><span class="o">=&gt;</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;span&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">text</span> <span class="k">switch</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">nth</span>
        <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="s">&#39;st&#39;</span>
        <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="s">&#39;nd&#39;</span>
        <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="s">&#39;rd&#39;</span>
        <span class="k">else</span> <span class="s">&#39;th&#39;</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.nth = </span><span class="nb">parseInt</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
        <span class="nx">pluralize</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.day = </span><span class="nb">parseInt</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
      <span class="nx">pluralize</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="nx">$el</span>
    
    
  <span class="k">class</span> <span class="nx">DayOfYear</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span>
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span> <span class="vi">@data.value = </span><span class="nx">d</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span> <span class="vi">@data.value = </span><span class="mi">1</span>
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;DayOfYear&quot;&gt;</span>
<span class="s">        &lt;input type=&quot;number&quot; value=</span><span class="si">#{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="s"> /&gt; day from the </span>
<span class="s">        &lt;select&gt;</span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;beggening&#39;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="si">}</span><span class="s"></span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="si">}</span><span class="s"></span>
<span class="s">        &lt;/select&gt; of the year.&lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>
      <span class="nv">$el = </span><span class="nx">$</span> <span class="nx">str</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input,select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.value = </span><span class="nb">parseInt</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
        <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">*=</span> <span class="k">if</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="nx">$el</span>
    
  <span class="k">class</span> <span class="nx">OffsetFromPascha</span> <span class="k">extends</span> <span class="nx">Option</span>
    <span class="nv">getData: </span><span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span>
    <span class="nv">fromData: </span><span class="nf">(d) -&gt;</span> <span class="vi">@data.value = </span><span class="nx">d</span>
    <span class="nv">defaults: </span><span class="o">-&gt;</span> <span class="vi">@data.value = </span><span class="mi">0</span>
    <span class="nv">render: </span><span class="o">-&gt;</span>
      <span class="nv">str = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&quot;OffsetFromPascha&quot;&gt;</span>
<span class="s">        &lt;input type=&quot;number&quot; value=</span><span class="si">#{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="s"> /&gt; days </span>
<span class="s">        &lt;select&gt;</span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;after&#39;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="si">}</span><span class="s"></span>
<span class="s">          </span><span class="si">#{</span><span class="nx">Helpers</span><span class="p">.</span><span class="nx">option</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;before&#39;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="si">}</span><span class="s"></span>
<span class="s">        &lt;/select&gt; Pascha.&lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span>
      <span class="nv">$el = </span><span class="nx">$</span> <span class="nx">str</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input,select&#39;</span><span class="p">).</span><span class="nx">change</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="vi">@data.value = </span><span class="nb">parseInt</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
        <span class="nx">@data</span><span class="p">.</span><span class="nx">value</span> <span class="o">*=</span> <span class="k">if</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>
      <span class="nx">$el</span>

  <span class="k">class</span> <span class="nx">ICUI</span>
    <span class="nv">constructor: </span><span class="nf">($el) -&gt;</span>
      <span class="k">try</span>
        <span class="vi">@root = </span><span class="k">new</span> <span class="nx">Root</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="k">catch</span> <span class="nx">e</span>
        <span class="vi">@root = </span><span class="k">new</span> <span class="nx">Root</span> <span class="nx">$el</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">parent</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">).</span><span class="kc">on</span> <span class="s">&#39;submit&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">$el</span><span class="p">.</span><span class="nx">val</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">@getData</span><span class="p">()</span>
      <span class="nx">$el</span><span class="p">.</span><span class="nx">after</span> <span class="nx">@root</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
  
    <span class="nv">getData: </span><span class="o">-&gt;</span>
      <span class="nx">@root</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>


  <span class="nv">$.fn.icui = </span><span class="o">-&gt;</span>
    <span class="nx">@</span><span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span>
      <span class="k">new</span> <span class="nx">ICUI</span> <span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 